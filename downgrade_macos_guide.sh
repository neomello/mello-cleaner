#!/bin/bash

echo "üì± GUIA PARA REVERTER VERS√ÉO DO macOS"
echo "======================================"
echo ""

# Cores
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

# Verificar vers√£o atual
current_version=$(sw_vers -productVersion)
echo -e "${BLUE}Vers√£o atual do macOS: ${current_version}${NC}"
echo ""

echo -e "${RED}‚ö†Ô∏è  ATEN√á√ÉO: REVERTER O macOS √â UM PROCESSO COMPLEXO E ARRISCADO${NC}"
echo "================================================================"
echo ""
echo "üìã PR√â-REQUISITOS OBRIGAT√ìRIOS:"
echo "==============================="
echo ""
echo "1. ‚úÖ BACKUP COMPLETO (Time Machine ou similar)"
echo "   - TODOS os seus arquivos devem estar em backup"
echo "   - Verifique se o backup est√° atualizado"
echo ""
echo "2. ‚úÖ BACKUP DO SISTEMA ATUAL"
echo "   - Crie um backup do sistema antes de prosseguir"
echo "   - Use Time Machine ou ferramenta similar"
echo ""
echo "3. ‚úÖ INSTALADOR DA VERS√ÉO ANTERIOR"
echo "   - Voc√™ precisa do instalador do macOS anterior"
echo "   - Baixe do App Store ou use outro m√©todo"
echo ""
echo "4. ‚ö†Ô∏è  PERDA DE DADOS"
echo "   - Voc√™ PERDER√Å todos os dados n√£o backupados"
echo "   - Aplicativos podem precisar ser reinstalados"
echo ""
echo "5. ‚ö†Ô∏è  INCOMPATIBILIDADES"
echo "   - Alguns apps podem n√£o funcionar na vers√£o antiga"
echo "   - Arquivos criados na vers√£o nova podem n√£o abrir"
echo ""

echo -e "${YELLOW}üìñ M√âTODOS PARA REVERTER:${NC}"
echo "======================"
echo ""
echo "M√âTODO 1: REINSTALA√á√ÉO LIMPA (RECOMENDADO)"
echo "-------------------------------------------"
echo "1. Fa√ßa backup completo com Time Machine"
echo "2. Baixe o instalador do macOS anterior:"
echo "   - macOS Sonoma (14.x): https://apps.apple.com/app/id6450717509"
echo "   - macOS Ventura (13.x): https://apps.apple.com/app/id1638787999"
echo "   - macOS Monterey (12.x): https://apps.apple.com/app/id1576738298"
echo ""
echo "3. Crie um USB boot√°vel:"
echo "   sudo /Applications/Install\\ macOS\\ [VERS√ÉO].app/Contents/Resources/createinstallmedia --volume /Volumes/[NOME_USB]"
echo ""
echo "4. Reinicie segurando Option (‚å•)"
echo "5. Selecione o USB boot√°vel"
echo "6. Use Disk Utility para APAGAR o disco"
echo "7. Instale o macOS anterior"
echo "8. Restaure do Time Machine"
echo ""

echo "M√âTODO 2: REINSTALA√á√ÉO SOBRE A VERS√ÉO ATUAL (N√ÉO RECOMENDADO)"
echo "-------------------------------------------------------------"
echo "‚ö†Ô∏è  Este m√©todo pode causar problemas de estabilidade"
echo "1. Baixe o instalador do macOS anterior"
echo "2. Execute o instalador"
echo "3. Ele tentar√° instalar sobre a vers√£o atual"
echo "4. Pode n√£o funcionar corretamente"
echo ""

echo "M√âTODO 3: RESTAURA√á√ÉO DO TIME MACHINE"
echo "-------------------------------------"
echo "1. Se voc√™ tem backup do Time Machine da vers√£o anterior:"
echo "2. Reinicie segurando Command (‚åò) + R"
echo "3. Selecione 'Restaurar do Time Machine Backup'"
echo "4. Escolha o backup da vers√£o anterior"
echo "5. Aguarde a restaura√ß√£o completa"
echo ""

echo -e "${RED}üö® RISCOS E LIMITA√á√ïES:${NC}"
echo "======================"
echo ""
echo "1. ‚ö†Ô∏è  PERDA DE DADOS:"
echo "   - Todos os dados n√£o backupados ser√£o perdidos"
echo "   - Aplicativos precisar√£o ser reinstalados"
echo ""
echo "2. ‚ö†Ô∏è  INCOMPATIBILIDADE:"
echo "   - Apps modernos podem n√£o funcionar"
echo "   - Arquivos criados na vers√£o nova podem n√£o abrir"
echo ""
echo "3. ‚ö†Ô∏è  SEGURAN√áA:"
echo "   - Vers√µes antigas t√™m menos atualiza√ß√µes de seguran√ßa"
echo "   - Vulnerabilidades conhecidas podem n√£o ser corrigidas"
echo ""
echo "4. ‚ö†Ô∏è  HARDWARE:"
echo "   - Alguns Macs novos n√£o suportam vers√µes antigas"
echo "   - Verifique compatibilidade antes"
echo ""

echo -e "${GREEN}üí° ALTERNATIVAS ANTES DE REVERTER:${NC}"
echo "================================"
echo ""
echo "Antes de reverter, tente estas solu√ß√µes:"
echo ""
echo "1. Reduzir transpar√™ncias:"
echo "   ./reduce_transparency.sh"
echo ""
echo "2. Otimizar sistema:"
echo "   make optimize-heating"
echo ""
echo "3. Limpar caches e arquivos tempor√°rios:"
echo "   make organize"
echo ""
echo "4. Verificar processos pesados:"
echo "   make diagnose-heating"
echo ""
echo "5. Desativar recursos desnecess√°rios:"
echo "   - Desative Siri se n√£o usar"
echo "   - Desative Handoff/Continuity"
echo "   - Reduza anima√ß√µes"
echo ""

echo ""
echo "üìû VERIFICAR COMPATIBILIDADE:"
echo "============================"
echo ""
echo "Para verificar se seu Mac suporta vers√µes anteriores:"
echo "1. Acesse: https://everymac.com"
echo "2. Procure pelo modelo do seu Mac"
echo "3. Veja quais vers√µes do macOS s√£o suportadas"
echo ""

echo -e "${YELLOW}‚ùì DESEJA CONTINUAR?${NC}"
echo "=================="
echo ""
echo "Este √© um processo IRREVERS√çVEL sem backup adequado."
echo "Tem certeza que deseja prosseguir? (digite 'SIM' para continuar)"
read -r confirm

if [[ "$confirm" != "SIM" ]]; then
    echo ""
    echo "Opera√ß√£o cancelada."
    echo "Recomendamos tentar as alternativas primeiro."
    exit 0
fi

echo ""
echo -e "${RED}‚ö†Ô∏è  √öLTIMA CHANCE!${NC}"
echo "=================="
echo ""
echo "Voc√™ fez backup completo? (s/N)"
read -r backup_confirm

if [[ ! "$backup_confirm" =~ ^[Ss]$ ]]; then
    echo ""
    echo "Opera√ß√£o cancelada por seguran√ßa."
    echo "Fa√ßa backup antes de continuar."
    exit 1
fi

echo ""
echo "üìã PR√ìXIMOS PASSOS:"
echo "=================="
echo ""
echo "1. Baixe o instalador do macOS anterior"
echo "2. Crie USB boot√°vel (se necess√°rio)"
echo "3. Reinicie e instale a vers√£o anterior"
echo "4. Restaure seus dados do backup"
echo ""
echo "Para mais informa√ß√µes detalhadas, consulte:"
echo "https://support.apple.com/pt-br/guide/mac-help/mchlp1599/mac"
echo ""

